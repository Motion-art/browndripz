<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - Guaptap Luxury Clothing</title>
    <link rel="stylesheet" href="../css/main.css">
    <style>
        .product-gallery img { width:100%; height:auto; object-fit:cover; }
        .variant-select { min-width: 200px; }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .hidden { display: none; }
        .error-state { 
            text-align: center; 
            padding: 40px; 
            background: #fef2f2; 
            border: 1px solid #fecaca;
            border-radius: 8px;
        }
        .fallback-content { display: none; }
    </style>
</head>
<body class="bg-background font-inter">
    <!-- Header Navigation -->
    <header id="main-header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-400 transition-premium">
        <div class="bg-primary/90 backdrop-blur-md border-b border-secondary/20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <!-- Logo -->
                    <div class="flex-shrink-0">
                        <a href="../index.html" class="flex items-center space-x-2 text-white">
                            <img src="../assets/guaptap.jpeg" alt="GUAPTAP Logo" class="w-8 h-8 rounded-full object-cover">
                            <span class="font-playfair font-bold text-xl tracking-wider">GUAPTAP</span>
                        </a>
                    </div>
                    
                    <!-- Desktop Navigation -->
                    <nav class="hidden md:flex items-center space-x-8">
                        <a href="collection_overview.html" class="text-white hover:text-accent transition-colors duration-300 font-inter font-medium">Collections</a>
                        <a href="style_guide.html" class="text-white hover:text-accent transition-colors duration-300 font-inter font-medium">Style Guide</a>
                        <a href="javascript:void(0)" class="text-white hover:text-accent transition-colors duration-300 font-inter font-medium">Craftsmanship</a>
                        <a href="javascript:void(0)" class="text-white hover:text-accent transition-colors duration-300 font-inter font-medium">About</a>
                    </nav>
                    
                    <!-- Search and Account -->
                    <div class="flex items-center space-x-4">
                        <a href="account_dashboard.html" class="text-white hover:text-accent transition-colors duration-300">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </a>
                        <a href="checkout.html" class="text-white hover:text-accent transition-colors duration-300 relative">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m6-5v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6m8 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v4.01"></path>
                            </svg>
                            <span class="absolute -top-2 -right-2 bg-accent text-white text-xs rounded-full w-4 h-4 flex items-center justify-center">2</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Loading State -->
    <section id="loading-state" class="pt-32 pb-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="loading-spinner"></div>
            <p class="mt-4 text-text-secondary">Loading product details...</p>
        </div>
    </section>

    <!-- Error State -->
    <section id="error-state" class="pt-32 pb-20 hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="error-state">
                <h2 class="font-playfair text-2xl text-primary mb-4">Unable to Load Product</h2>
                <p class="text-text-secondary mb-4" id="error-message">We're having trouble loading this product.</p>
                <button id="retry-btn" class="btn-primary mr-4">Retry Loading</button>
                <button id="use-fallback-btn" class="btn-secondary">View Basic Product Info</button>
            </div>
        </div>
    </section>

    <!-- Main Product Content -->
    <main id="product-content" class="hidden">
        <!-- Content will be loaded here dynamically -->
    </main>

    <!-- Fallback Static Content (Hidden by default) -->
    <div id="fallback-content" class="fallback-content">
        <!-- Breadcrumb Navigation -->
        <section class="pt-20 pb-4 bg-surface">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <nav class="flex items-center space-x-2 text-base font-inter">
                    <a href="../index.html" class="text-text-secondary hover:text-accent transition-colors duration-300">Home</a>
                    <svg class="w-4 h-4 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                    <a href="collection_overview.html" class="text-text-secondary hover:text-accent transition-colors duration-300">Collections</a>
                    <svg class="w-4 h-4 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                    <span class="text-primary font-medium" id="fallback-product-title">Product</span>
                </nav>
            </div>
        </section>

        <!-- Product Detail Section -->
        <section class="py-8 bg-background">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                    <!-- Product Gallery -->
                    <div class="space-y-4">
                        <div class="relative overflow-hidden bg-surface aspect-square">
                            <img id="fallback-main-image" 
                                 src="https://images.unsplash.com/photo-1729179664983-71fcd73f4fa5" 
                                 alt="Premium streetwear product" 
                                 class="w-full h-full object-cover">
                        </div>
                        <div class="grid grid-cols-4 gap-4">
                            <button class="aspect-square overflow-hidden bg-surface border-2 border-accent">
                                <img src="https://images.unsplash.com/photo-1585412459060-26478a8435b2" 
                                     alt="Product view 1" 
                                     class="w-full h-full object-cover">
                            </button>
                            <button class="aspect-square overflow-hidden bg-surface border-2 border-transparent hover:border-accent">
                                <img src="https://images.unsplash.com/photo-1677865993566-ab3a89f20948" 
                                     alt="Product view 2" 
                                     class="w-full h-full object-cover">
                            </button>
                            <button class="aspect-square overflow-hidden bg-surface border-2 border-transparent hover:border-accent">
                                <img src="https://images.unsplash.com/photo-1723995625656-63ae3d3d77a6" 
                                     alt="Product view 3" 
                                     class="w-full h-full object-cover">
                            </button>
                            <button class="aspect-square overflow-hidden bg-surface border-2 border-transparent hover:border-accent">
                                <img src="https://images.unsplash.com/photo-1585412459060-26478a8435b2" 
                                     alt="Product view 4" 
                                     class="w-full h-full object-cover">
                            </button>
                        </div>
                    </div>

                    <!-- Product Information -->
                    <div class="space-y-8">
                        <div>
                            <h1 class="font-playfair font-semibold text-4xl text-primary mb-4" id="fallback-title">Signature Hoodie</h1>
                            <p class="font-inter text-lg text-text-secondary mb-6">Premium loopback cotton blend with relaxed street silhouette</p>
                            <div class="flex items-center space-x-4 mb-6">
                                <span class="font-inter font-semibold text-3xl text-primary">$129</span>
                                <span class="font-inter text-text-secondary line-through">$159</span>
                                <span class="bg-accent text-white px-3 py-1 text-sm font-medium">19% OFF</span>
                            </div>
                        </div>

                        <!-- Size Selection -->
                        <div>
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-inter font-semibold text-lg text-primary">Size</h3>
                                <button class="text-accent hover:text-accent/80 font-inter text-sm font-medium" onclick="openSizeGuide()">
                                    Size Guide
                                </button>
                            </div>
                            <div class="grid grid-cols-4 gap-3">
                                <button class="size-btn border-2 border-gray-300 py-3 text-center font-inter font-medium">XS</button>
                                <button class="size-btn border-2 border-gray-300 py-3 text-center font-inter font-medium">S</button>
                                <button class="size-btn border-2 border-accent bg-accent text-white py-3 text-center font-inter font-medium">M</button>
                                <button class="size-btn border-2 border-gray-300 py-3 text-center font-inter font-medium">L</button>
                                <button class="size-btn border-2 border-gray-300 py-3 text-center font-inter font-medium">XL</button>
                                <button class="size-btn border-2 border-gray-300 py-3 text-center font-inter font-medium">XXL</button>
                            </div>
                        </div>

                        <!-- Add to Cart Section -->
                        <div class="space-y-4">
                            <div class="flex space-x-4">
                                <button class="flex-1 btn-primary py-4 text-lg add-to-cart-fallback">
                                    Add to Cart
                                </button>
                                <button class="p-4 border-2 border-accent text-accent hover:bg-accent hover:text-white">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                    </svg>
                                </button>
                            </div>
                            <button class="block w-full btn-accent py-4 text-lg text-center buy-now-fallback">
                                Buy Now - Express Checkout
                            </button>
                        </div>

                        <!-- Key Features -->
                        <div class="bg-surface p-6 space-y-4">
                            <h3 class="font-playfair font-semibold text-xl text-primary mb-4">Key Features</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span class="font-inter text-sm text-text-primary">Premium Cotton Blend</span>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span class="font-inter text-sm text-text-primary">Hand-Finished Details</span>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span class="font-inter text-sm text-text-primary">Contemporary Fit</span>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span class="font-inter text-sm text-text-primary">Reinforced Seams</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="bg-primary text-white py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <!-- Brand -->
                <div class="col-span-1 md:col-span-2">
                    <h3 class="font-playfair font-bold text-2xl mb-4">GUAPTAP</h3>
                    <p class="font-inter text-white/80 mb-6 max-w-md">
                        Crafting premium streetwear for the modern urban individual. Where heritage meets street innovation in every stitch.
                    </p>
                </div>
                
                <!-- Quick Links -->
                <div>
                    <h4 class="font-inter font-semibold text-lg mb-4">Quick Links</h4>
                    <ul class="space-y-2">
                        <li><a href="collection_overview.html" class="font-inter text-white/80 hover:text-white transition-colors duration-300">Collections</a></li>
                        <li><a href="style_guide.html" class="font-inter text-white/80 hover:text-white transition-colors duration-300">Style Guide</a></li>
                        <li><a href="javascript:void(0)" class="font-inter text-white/80 hover:text-white transition-colors duration-300">About Us</a></li>
                    </ul>
                </div>
                
                <!-- Customer Service -->
                <div>
                    <h4 class="font-inter font-semibold text-lg mb-4">Customer Service</h4>
                    <ul class="space-y-2">
                        <li><a href="javascript:void(0)" class="font-inter text-white/80 hover:text-white transition-colors duration-300">Size Guide</a></li>
                        <li><a href="javascript:void(0)" class="font-inter text-white/80 hover:text-white transition-colors duration-300">Returns</a></li>
                        <li><a href="javascript:void(0)" class="font-inter text-white/80 hover:text-white transition-colors duration-300">Shipping</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-white/20 mt-12 pt-8 text-center">
                <p class="font-inter text-white/60">
                    Â© 2025 Guaptap Luxury Clothing. All Rights Reserved.
                </p>
            </div>
        </div>
    </footer>

    <script>
        // State management
        let currentProduct = null;
        let shopifyInitialized = false;

        // DOM elements
        const loadingState = document.getElementById('loading-state');
        const errorState = document.getElementById('error-state');
        const productContent = document.getElementById('product-content');
        const fallbackContent = document.getElementById('fallback-content');
        const retryBtn = document.getElementById('retry-btn');
        const useFallbackBtn = document.getElementById('use-fallback-btn');
        const errorMessage = document.getElementById('error-message');

        // Show/hide functions
        function showLoading() {
            loadingState.classList.remove('hidden');
            errorState.classList.add('hidden');
            productContent.classList.add('hidden');
            fallbackContent.classList.add('hidden');
        }

        function showError(message) {
            loadingState.classList.add('hidden');
            errorState.classList.remove('hidden');
            productContent.classList.add('hidden');
            fallbackContent.classList.add('hidden');
            errorMessage.textContent = message || 'We\'re having trouble loading this product.';
        }

        function showProduct() {
            loadingState.classList.add('hidden');
            errorState.classList.add('hidden');
            productContent.classList.remove('hidden');
            fallbackContent.classList.add('hidden');
        }

        function showFallback() {
            loadingState.classList.add('hidden');
            errorState.classList.add('hidden');
            productContent.classList.add('hidden');
            fallbackContent.classList.remove('hidden');
        }

        // Initialize Shopify with fallback
        async function initShopifyWithFallback() {
            try {
                // Try to load Shopify config
                const { SHOP, API_VERSION, STOREFRONT_TOKEN } = await import('../config/shopify-config.js');
                const { initShopify, getProductByHandle } = await import('../src/js/shopify-client.js');
                
                initShopify({ shop: SHOP, apiVersion: API_VERSION, token: STOREFRONT_TOKEN });
                shopifyInitialized = true;
                return { getProductByHandle };
            } catch (error) {
                console.warn('Shopify config not found, using fallback mode:', error);
                shopifyInitialized = false;
                return { getProductByHandle: null };
            }
        }

        // Load product data
        async function loadProduct() {
            showLoading();
            
            try {
                const { getProductByHandle } = await initShopifyWithFallback();
                
                // Get product handle from URL
                const urlParams = new URLSearchParams(window.location.search);
                const handle = urlParams.get('handle');
                
                if (!handle) {
                    throw new Error('No product specified. Please select a product from the collections page.');
                }

                if (!shopifyInitialized || !getProductByHandle) {
                    throw new Error('Shopify not configured. Using fallback product information.');
                }

                // Fetch product data from Shopify
                const product = await getProductByHandle(handle);
                
                if (!product) {
                    throw new Error('Product not found in Shopify.');
                }

                currentProduct = product;
                renderProduct(product);
                showProduct();
                
            } catch (error) {
                console.error('Failed to load product:', error);
                
                // Update fallback content with product handle if available
                const urlParams = new URLSearchParams(window.location.search);
                const handle = urlParams.get('handle');
                if (handle) {
                    const fallbackTitle = document.getElementById('fallback-product-title');
                    const fallbackMainTitle = document.getElementById('fallback-title');
                    const formattedTitle = handle.split('-').map(word => 
                        word.charAt(0).toUpperCase() + word.slice(1)
                    ).join(' ');
                    fallbackTitle.textContent = formattedTitle;
                    fallbackMainTitle.textContent = formattedTitle;
                }
                
                showError(error.message);
            }
        }

        // Render product from Shopify data
        function renderProduct(product) {
            const images = product.images?.edges?.map(edge => edge.node) || [];
            const featuredImage = product.featuredImage?.url || (images[0]?.url || 'https://images.unsplash.com/photo-1729179664983-71fcd73f4fa5');
            const price = product.priceRange?.minVariantPrice?.amount || '129';
            const variants = product.variants?.edges?.map(edge => edge.node) || [];
            const availableVariants = variants.filter(v => v.availableForSale);

            // Update page title
            document.title = `${product.title} - Guaptap Luxury Clothing`;

            // Create product HTML
            productContent.innerHTML = `
                <!-- Breadcrumb Navigation -->
                <section class="pt-20 pb-4 bg-surface">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <nav class="flex items-center space-x-2 text-base font-inter">
                            <a href="../index.html" class="text-text-secondary hover:text-accent transition-colors duration-300">Home</a>
                            <svg class="w-4 h-4 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                            <a href="collection_overview.html" class="text-text-secondary hover:text-accent transition-colors duration-300">Collections</a>
                            <svg class="w-4 h-4 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                            <span class="text-primary font-medium">${escapeHtml(product.title)}</span>
                        </nav>
                    </div>
                </section>

                <!-- Product Detail Section -->
                <section class="py-8 bg-background">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                            <!-- Product Gallery -->
                            <div class="space-y-4">
                                <div class="relative overflow-hidden bg-surface aspect-square">
                                    <img src="${featuredImage}" 
                                         alt="${escapeHtml(product.title)}" 
                                         class="w-full h-full object-cover">
                                </div>
                                ${images.length > 1 ? `
                                <div class="grid grid-cols-4 gap-4">
                                    ${images.map((image, index) => `
                                        <button class="aspect-square overflow-hidden bg-surface border-2 ${index === 0 ? 'border-accent' : 'border-transparent'} hover:border-accent">
                                            <img src="${image.url}" 
                                                 alt="${escapeHtml(image.altText || product.title)}" 
                                                 class="w-full h-full object-cover">
                                        </button>
                                    `).join('')}
                                </div>
                                ` : ''}
                            </div>

                            <!-- Product Information -->
                            <div class="space-y-8">
                                <div>
                                    <h1 class="font-playfair font-semibold text-4xl text-primary mb-4">${escapeHtml(product.title)}</h1>
                                    <p class="font-inter text-lg text-text-secondary mb-6">${escapeHtml(product.description || 'Premium streetwear collection')}</p>
                                    <div class="flex items-center space-x-4 mb-6">
                                        <span class="font-inter font-semibold text-3xl text-primary">$${price}</span>
                                    </div>
                                </div>

                                ${availableVariants.length > 0 ? `
                                <!-- Variant Selection -->
                                <div>
                                    <h3 class="font-inter font-semibold text-lg text-primary mb-4">Available Options</h3>
                                    <div class="space-y-2">
                                        ${availableVariants.map(variant => `
                                            <div class="flex items-center justify-between p-3 border border-gray-200 rounded">
                                                <span class="font-inter">${escapeHtml(variant.title)}</span>
                                                <span class="font-inter font-semibold">$${variant.priceV2?.amount || price}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                ` : ''}

                                <!-- Add to Cart Section -->
                                <div class="space-y-4">
                                    <div class="flex space-x-4">
                                        <button class="flex-1 btn-primary py-4 text-lg add-to-cart-dynamic">
                                            Add to Cart - $${price}
                                        </button>
                                        <button class="p-4 border-2 border-accent text-accent hover:bg-accent hover:text-white">
                                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                            </svg>
                                        </button>
                                    </div>
                                    <button class="block w-full btn-accent py-4 text-lg text-center buy-now-dynamic">
                                        Buy Now - Express Checkout
                                    </button>
                                </div>

                                <!-- Product Features -->
                                <div class="bg-surface p-6 space-y-4">
                                    <h3 class="font-playfair font-semibold text-xl text-primary mb-4">Product Features</h3>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div class="flex items-center space-x-3">
                                            <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                            </svg>
                                            <span class="font-inter text-sm text-text-primary">Premium Materials</span>
                                        </div>
                                        <div class="flex items-center space-x-3">
                                            <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                            </svg>
                                            <span class="font-inter text-sm text-text-primary">Expert Craftsmanship</span>
                                        </div>
                                        <div class="flex items-center space-x-3">
                                            <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                            </svg>
                                            <span class="font-inter text-sm text-text-primary">Contemporary Fit</span>
                                        </div>
                                        <div class="flex items-center space-x-3">
                                            <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                            </svg>
                                            <span class="font-inter text-sm text-text-primary">Quality Guarantee</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            `;

            // Add event listeners for dynamic content
            setupEventListeners();
        }

        // Utility function to escape HTML
        function escapeHtml(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Size selection
            document.querySelectorAll('.size-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.size-btn').forEach(b => {
                        b.classList.remove('border-accent', 'bg-accent', 'text-white');
                        b.classList.add('border-gray-300');
                    });
                    this.classList.add('border-accent', 'bg-accent', 'text-white');
                    this.classList.remove('border-gray-300');
                });
            });

            // Add to cart buttons
            document.querySelectorAll('.add-to-cart-dynamic, .add-to-cart-fallback').forEach(btn => {
                btn.addEventListener('click', function() {
                    alert('Product added to cart! (Shopify integration required for full functionality)');
                });
            });

            // Buy now buttons
            document.querySelectorAll('.buy-now-dynamic, .buy-now-fallback').forEach(btn => {
                btn.addEventListener('click', function() {
                    alert('Proceeding to checkout... (Shopify integration required for full functionality)');
                });
            });
        }

        // Size guide modal function
        function openSizeGuide() {
            alert('Size guide would open here. This is a fallback implementation.');
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Set up retry button
            retryBtn.addEventListener('click', loadProduct);
            
            // Set up fallback button
            useFallbackBtn.addEventListener('click', showFallback);
            
            // Start loading the product
            loadProduct();
        });

        // Header scroll behavior
        let lastScrollTop = 0;
        const header = document.getElementById('main-header');
        
        window.addEventListener('scroll', function() {
            let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (scrollTop > lastScrollTop && scrollTop > 100) {
                header.style.transform = 'translateY(-100%)';
            } else {
                header.style.transform = 'translateY(0)';
            }
            
            if (scrollTop > 50) {
                header.classList.add('backdrop-blur-md');
            } else {
                header.classList.remove('backdrop-blur-md');
            }
            
            lastScrollTop = scrollTop;
        });
    </script>
</body>
</html>